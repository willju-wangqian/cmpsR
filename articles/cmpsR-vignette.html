<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cmpsR-vignette • cmpsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cmpsR-vignette">
<meta property="og:description" content="cmpsR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmpsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmpsR-vignette.html">cmpsR-vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cmpsR-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cmpsR-vignette</h1>
            
      
      
      <div class="hidden name"><code>cmpsR-vignette.Rmd</code></div>

    </div>

    
    
<p>The <code>cmpsR</code> package is an implementation of the Congruent Matching Profile Segments (CMPS) method (Chen et al. 2019). In general, it can be used for objective comparison of striated tool marks, but in our examples, we mainly use it for bullet signatures comparison. The CMPS score is expected to be large if two signatures are similar. So it can also be considered as a feature that measures the similarity of two bullet signatures.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of cmpsR from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cmpsR"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"willju-wangqian/cmpsR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-and-summary-of-the-algorithm">Example and Summary of the Algorithm<a class="anchor" aria-label="anchor" href="#example-and-summary-of-the-algorithm"></a>
</h2>
<p>In this section we use a known match (KM) compasison (of two bullets) to illustrate the main ideas of CMPS algorithm and to showcase the <code>cmpsR</code> implementation. The <code>cmpsR</code> package includes a simple data set of 12 bullet signatures generated from two bullets (each bullet has 6 bullet signatures). These bullet data come from the James Hamby Consecutively Rifled Ruger Barrel Study (Brundage 1998; Hamby, Brundage, and Thorpe 2009; Hamby et al. 2019), and the two bullets included in <code>cmpsR</code> are just a subset of Hamby set 252. These bullet data in their original format can also be found in Chapter 3.5 of <a href="https://sctyner.github.io/OpenForSciR/bullets.html#case-study-1" class="external-link">Open Forensic Science in R</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cmpsR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bullets"</span><span class="op">)</span></span></code></pre></div>
<p>A comparison of two bullets is considered as a match if two bullets are fired from the same barrel (come from the same source). The gun barrel used in the Hamby study has 6 lands, and during the firing process striation marks will be engraved on the bullet by these lands. A bullet signature is a numerical representation of the striation marks engraved by a land. This is why each bullet can generate 6 bullet signatures. Two bullet signatures are a match if they are originally engraved by the same land in a gun barrel. Therefore, two bullets of a known-match comparison will have 36 pairwise bullet signature comparisons, and 6 of them are matching bullet signature comparisons while 30 of them are non-matching bullet signature comparisons.</p>
<p>Here we plot the twelve bullet signatures of the two bullets. The bullet signatures are aligned so that the top figure and the bottom figure of the same column are a matching bullet signature comparison.</p>
<p><img src="figures/vignette-signature_plot-1.png" width="80%"></p>
<p>To further illustrate the idea of the CMPS algorithm, let’s consider one matching bullet signature comparison: bullet signature of bullet 1 land 2 and bullet signature of bullet 2 land 3 (the second column), and compute the CMPS score of this comparison:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cmpsR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bullets"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"2-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sig</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"1-2"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sig</span></span>
<span></span>
<span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, include <span class="op">=</span> <span class="st">"full_result"</span><span class="op">)</span></span>
<span><span class="va">cmps</span><span class="op">$</span><span class="va">CMPS_score</span></span>
<span><span class="co">#&gt; [1] 18</span></span></code></pre></div>
<p>And we have the plot of <code>x</code> and <code>y</code>.</p>
<!-- # ```{r plot_example, fig.cap="A KM Comparison, x and y", out.width="80%", fig.keep="hold", fig.align='center'} -->
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_example-1.png" alt="A KM Comparison, x and y" width="80%"><p class="caption">
A KM Comparison, x and y
</p>
</div>
<div class="section level4">
<h4 id="main-idea">Main Idea<a class="anchor" aria-label="anchor" href="#main-idea"></a>
</h4>
<p>The main idea of the CMPS method is that:</p>
<ol style="list-style-type: decimal">
<li>we take the first signature as the comparison signature (<code>x</code> or bullet signature of “2-3”) and cut it into consecutive and non-overlapping basis segments of the same length. In this case, we set the length of a basis segment to be 50 units, and we have 22 basis segments in total for bullet signature <code>x</code>.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_cut_x-1.png" alt="Cut x into consecutive and non-overlapping basis segments of the same length. Only 4 basis segments are shown here" width="80%"><p class="caption">
Cut x into consecutive and non-overlapping basis segments of the same length. Only 4 basis segments are shown here
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>for each basis segment, we compute the cross-correlation function (ccf) between the basis segment and the reference signature (<code>y</code> or bullet signature of “1-2”)</li>
</ol>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_y_and_seg-1.png" alt="y and 7th basis segment" width="80%"><p class="caption">
y and 7th basis segment
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_ccf_y_seg-1.png" alt="the cross-correlation function (ccf) between y and segment 7" width="80%"><p class="caption">
the cross-correlation function (ccf) between y and segment 7
</p>
</div>
<ul>
<li>for the <code>ccf</code> curve, the <code>position</code> represents the shift of the segment. A negative value means a shift to the left, a positive value means a shift to the right, and 0 means no shift (the segment stays at its original position in the reference signature);</li>
<li>we are interested in the peaks in the ccf curve and the positions of those peaks (as indicated by the red vertical line in the plot above). In other words, if we shift the segment, which position would give us the “best fit”?</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>If two signatures are from a KM comparison, most of the basis segments should agree with each other on the position of the best fit. Then these segments are called the “<strong>Congruent Matching Profile Segments (CMPS)</strong>”.</li>
</ol>
<p>Ideally, if two signatures are identical, we are expecting the position of the highest peak in the ccf curve remains the same across all ccf curves (we only show 7 segments here);</p>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_x_itself-1.png" alt="ideal case: compare x to itself. The highest peak has value 1 and is marked by the blue dot" width="80%"><p class="caption">
ideal case: compare x to itself. The highest peak has value 1 and is marked by the blue dot
</p>
</div>
<p>But in the real case, the basis segments might not achieve a final agreement, but we have the majority;</p>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_real_xy-1.png" alt="real case: compare x to y. The 5 highest peaks are marked by the blue dots" width="80%"><p class="caption">
real case: compare x to y. The 5 highest peaks are marked by the blue dots
</p>
</div>
<p>We mark the 5 highest peaks for each ccf curve because the position of the “highest peak” might not be the best one.</p>
<ol start="4" style="list-style-type: decimal">
<li>each ccf curve votes for 5 candidate positions, then we ask two questions in order to obtain the CMPS number/score:</li>
</ol>
<ul>
<li><p>which position receives the most votes? -&gt; the best position (indicated by the red vertical line)</p></li>
<li>
<p>how many segments have voted for the best position? -&gt; CMPS score</p>
<p>If we focus on these 7 segments only, and have a very short tolerance zone, the CMPS number is 6.</p>
<p>(If we consider all 22 segments, and have a default tolerance zone (+/- 25 units), the CMPS number is 20.)</p>
</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>false positive: how can the segments vote more wisely? -&gt; Multi Segment Lengths Strategy</li>
</ol>
<ul>
<li><p>by increasing the segment length, one can reduce the number of “false positive” peaks.</p></li>
<li><p>the first scale level is the original length of segment 7; for the second scale level, we double its length while keeping its center. That is, we include 25 more units from both the left and right side of the segment 7 to obtain a segment of 100 units length. For the third scale level, we double the segment length again to obtain a segment of length 200.</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_false_positive-1.png" alt="Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves" width="80%"><p class="caption">
Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figures/vignette-plot_false_positive-2.png" alt="Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves" width="80%"><p class="caption">
Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves
</p>
</div>
<ul>
<li>
<p>we choose five peaks at scale level 1; three peaks at scale level 2; one peak at scale level 3</p>
<p>the peak shared by all three scale levels is a <strong>consistent correlation peak</strong> (ccp). And the position of the ccp is our best choice. Sometimes a ccp might not be found. Trying to identify a ccp for each basis segment is called a “multi segment lengths” strategy.</p>
<p>The following plots (generated by <code><a href="../reference/cmps_segment_plot.html">cmpsR::cmps_segment_plot</a></code>) summarize the information of the two above plots. It shows that segment 7 finds a consistent correlation peak (ccp) at a position near 0 (position <code>-6</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, include <span class="op">=</span> <span class="st">"full_result"</span><span class="op">)</span></span>
<span><span class="va">cmps_plot_list</span> <span class="op">&lt;-</span> <span class="fu">cmpsR</span><span class="fu">::</span><span class="fu"><a href="../reference/cmps_segment_plot.html">cmps_segment_plot</a></span><span class="op">(</span><span class="va">cmps</span>, seg_idx <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">cmps_plot_list</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                  nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/vignette-plot_ccf_seg7-1.png" width="80%"></p>
</li>
<li>
<p>In this case, since segment 7 identifies a ccp, it casts a vote for position <code>-6</code>. Then we ask two questions:</p>
<ul>
<li>which position receives the most votes (within a tolerance zone specified by <code>Tx</code>)?</li>
<li>how many segments have voted for this position? -&gt; CMPS score</li>
</ul>
</li>
<li><p>by default, CMPS algorithm uses the multi-segment lengths strategy. Use <code><a href="../reference/extract_feature_cmps.html">?cmpsR::extract_feature_cmps</a></code> to learn more about the function, including its default settings.</p></li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>If we follow the procedure described above (using the multi-segment lengths strategy) and investigate all 22 basis segments, we can find that 18 of them have cast a vote for position <code>0</code> <span class="math inline">\(\pm 25\)</span> (since <code>Tx = 25</code> by default). Therefore, for this KM bullet signature comparison, the CMPS score is 18.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, seg_length <span class="op">=</span> <span class="fl">50</span>, Tx <span class="op">=</span> <span class="fl">25</span>, </span>
<span>                     npeaks_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, include <span class="op">=</span> <span class="st">"full_result"</span><span class="op">)</span></span>
<span><span class="va">cmps</span><span class="op">$</span><span class="va">CMPS_score</span></span>
<span><span class="co">#&gt; [1] 18</span></span></code></pre></div>
<ul>
<li>
<p>Segment 6 doesn’t cast a vote. Take a look at the following plot to find out why.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps_plot_list</span> <span class="op">&lt;-</span> <span class="fu">cmpsR</span><span class="fu">::</span><span class="fu"><a href="../reference/cmps_segment_plot.html">cmps_segment_plot</a></span><span class="op">(</span><span class="va">cmps</span>, seg_idx <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">cmps_plot_list</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                  nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/vignette-plot_ccf_seg6-1.png" width="80%"></p>
<p>It doesn’t identify a consistent correlation peak.</p>
</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>If we have a KNM (known non-match) comparison, e.g. compare bullet signature 2-3 with 1-3:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">land23</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"2-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">land13</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"1-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cmps_knm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">land23</span><span class="op">$</span><span class="va">sig</span>, <span class="va">land13</span><span class="op">$</span><span class="va">sig</span>, seg_length <span class="op">=</span> <span class="fl">50</span>, Tx <span class="op">=</span> <span class="fl">25</span>, </span>
<span>                     npeaks_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, include<span class="op">=</span><span class="st">"full_result"</span><span class="op">)</span></span>
<span><span class="va">cmps_knm</span><span class="op">$</span><span class="va">CMPS_score</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="full-comparison-between-two-bullets">Full Comparison Between Two Bullets<a class="anchor" aria-label="anchor" href="#full-comparison-between-two-bullets"></a>
</h4>
<p><code><a href="../reference/extract_feature_cmps.html">extract_feature_cmps()</a></code> can also be used in a pipeline fashion. The following code performs a full comparison of two bullets. That is, it evaluates all 36 pairwise bullet signature comparisons and computes the CMPS scores.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cmpsR</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bullets"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>land1 <span class="op">=</span> <span class="va">lands</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, land2 <span class="op">=</span> <span class="va">lands</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                          stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bullets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bulletland</span>, sig1<span class="op">=</span><span class="va">sigs</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"land1"</span> <span class="op">=</span> <span class="st">"bulletland"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bullets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bulletland</span>, sig2<span class="op">=</span><span class="va">sigs</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"land2"</span> <span class="op">=</span> <span class="st">"bulletland"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  cmps <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">sig1</span>, <span class="va">sig2</span>, .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">sig</span>, <span class="va">y</span><span class="op">$</span><span class="va">sig</span>, include <span class="op">=</span> <span class="st">"full_result"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cmps_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">cmps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">CMPS_score</span><span class="op">)</span>,</span>
<span>    cmps_nseg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">cmps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">nseg</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="va">cp1</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">land1</span>, <span class="va">land2</span>, <span class="va">cmps_score</span>, <span class="va">cmps_nseg</span><span class="op">)</span></span>
<span><span class="va">cp1</span>  </span>
<span><span class="co">#&gt;    land1 land2 cmps_score cmps_nseg</span></span>
<span><span class="co">#&gt; 1    1-1   2-1          2        23</span></span>
<span><span class="co">#&gt; 2    1-2   2-1          2        22</span></span>
<span><span class="co">#&gt; 3    1-3   2-1          1        21</span></span>
<span><span class="co">#&gt; 4    1-4   2-1          2        22</span></span>
<span><span class="co">#&gt; 5    1-5   2-1          2        23</span></span>
<span><span class="co">#&gt; 6    1-6   2-1         16        22</span></span>
<span><span class="co">#&gt; 7    1-1   2-2          3        23</span></span>
<span><span class="co">#&gt; 8    1-2   2-2          1        22</span></span>
<span><span class="co">#&gt; 9    1-3   2-2          1        21</span></span>
<span><span class="co">#&gt; 10   1-4   2-2          1        22</span></span>
<span><span class="co">#&gt; 11   1-5   2-2          2        23</span></span>
<span><span class="co">#&gt; 12   1-6   2-2          3        22</span></span>
<span><span class="co">#&gt; 13   1-1   2-3          2        23</span></span>
<span><span class="co">#&gt; 14   1-2   2-3         17        22</span></span>
<span><span class="co">#&gt; 15   1-3   2-3          3        21</span></span>
<span><span class="co">#&gt; 16   1-4   2-3          1        22</span></span>
<span><span class="co">#&gt; 17   1-5   2-3          1        23</span></span>
<span><span class="co">#&gt; 18   1-6   2-3          1        22</span></span>
<span><span class="co">#&gt; 19   1-1   2-4          2        23</span></span>
<span><span class="co">#&gt; 20   1-2   2-4          1        22</span></span>
<span><span class="co">#&gt; 21   1-3   2-4         14        21</span></span>
<span><span class="co">#&gt; 22   1-4   2-4          1        22</span></span>
<span><span class="co">#&gt; 23   1-5   2-4          1        23</span></span>
<span><span class="co">#&gt; 24   1-6   2-4          2        22</span></span>
<span><span class="co">#&gt; 25   1-1   2-5          1        23</span></span>
<span><span class="co">#&gt; 26   1-2   2-5          2        22</span></span>
<span><span class="co">#&gt; 27   1-3   2-5          1        21</span></span>
<span><span class="co">#&gt; 28   1-4   2-5         10        22</span></span>
<span><span class="co">#&gt; 29   1-5   2-5          1        23</span></span>
<span><span class="co">#&gt; 30   1-6   2-5          1        22</span></span>
<span><span class="co">#&gt; 31   1-1   2-6          2        23</span></span>
<span><span class="co">#&gt; 32   1-2   2-6          3        22</span></span>
<span><span class="co">#&gt; 33   1-3   2-6          1        21</span></span>
<span><span class="co">#&gt; 34   1-4   2-6          1        22</span></span>
<span><span class="co">#&gt; 35   1-5   2-6         15        23</span></span>
<span><span class="co">#&gt; 36   1-6   2-6          1        22</span></span></code></pre></div>
<p>The following plot summarizes the CMPS scores computed above.</p>
<p><img src="figures/vignette-plot_all_pairwise-1.png" width="80%"></p>
</div>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<p>Chen, Zhe, Wei Chu, Johannes A Soons, Robert M Thompson, John Song, and Xuezeng Zhao. 2019. “Fired Bullet Signature Correlation Using the Congruent Matching Profile Segments (CMPS) Method.” Forensic Science International, December, #109964. <a href="https://doi.org/10.1016/j.forsciint.2019.109964" class="external-link uri">https://doi.org/10.1016/j.forsciint.2019.109964</a>.</p>
<p>Brundage, David J. 1998. “The Identification of Consecutively Rifled Gun Barrels.” AFTE Journal 30 (3): 438–44.</p>
<p>Hamby, James E., David J. Brundage, Nicholas D. K. Petraco, and James W. Thorpe. 2019. “A Worldwide Study of Bullets Fired From 10 Consecutively Rifled 9mm RUGER Pistol Barrels—Analysis of Examiner Error Rate.” Journal of Forensic Sciences 64 (2): 551–57. <a href="https://doi.org/10.1111/1556-4029.13916" class="external-link uri">https://doi.org/10.1111/1556-4029.13916</a>.</p>
<p>Hamby, James E., David J. Brundage, and James W. Thorpe. 2009. “The Identification of Bullets Fired from 10 Consecutively Rifled 9mm Ruger Pistol Barrels: A Research Project Involving 507 Participants from 20 Countries.” AFTE Journal 41 (2): 99–110.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wangqian Ju.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
