<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implementation of Congruent Matching Profile Segments (CMPS) Method • cmpsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Implementation of Congruent Matching Profile Segments (CMPS) Method">
<meta property="og:description" content="The cmpsR package is an open-source implementation of the Congruent Matching 
    Profile Segments (CMPS) method (Chen et al. 2019). In general, it can be used for 
    objective comparison of striated tool marks, and in our examples, we specifically use  
    it for bullet signatures comparisons. The CMPS score is expected to be large if two 
    signatures are similar. So it can also be considered as a feature that measures the 
    similarity of two bullet signatures.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">cmpsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="cmpsr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#cmpsr" class="anchor"></a>cmpsR</h1></div>
<!-- badges: start -->

<p>The <code>cmpsR</code> package is an implementation of the Congruent Matching Profile Segments (CMPS) method (Chen et al. 2019). In general, it can be used for objective comparison of striated tool marks, but in our examples, we mainly use it for bullet profiles/signatures comparison. The CMPS number is expected to be large if two signatures are similar. So it can also be considered as a feature that measures the similarity of two bullets.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of cmpsR from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"cmpsR"</span><span class="op">)</span></code></pre></div>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"willju-wangqian/cmpsR"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-and-summary-of-the-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#example-and-summary-of-the-algorithm" class="anchor"></a>Example and Summary of the Algorithm</h2>
<p>In this section we use a known match (KM) compasison to illustrate the main ideas of CMPS algorithm. The bullet data used here can be found in Chapter 3.5 of <a href="https://sctyner.github.io/OpenForSciR/bullets.html#case-study-1">Open Forensic Science in R</a>.</p>
<p>We can also run the following chunk. In this example, we are taking the signature of the third land engraved area (LEA) of the second bullet as the reference signature and the second LEA of the first bullet as the comparison signature. This is a KM comparison.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmpsR</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"bullets"</span><span class="op">)</span>
<span class="va">land23</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"2-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">land12</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"1-2"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">land23</span><span class="op">$</span><span class="va">sig</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">land12</span><span class="op">$</span><span class="va">sig</span>

<span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, full_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cmps</span>

<span class="co"># $CMPS.score</span>
<span class="co"># [1] 14</span>
<span class="co"># </span>
<span class="co"># $rec.position</span>
<span class="co"># [1] -5</span>
<span class="co"># </span>
<span class="co"># $pos.df</span>
<span class="co">#   position cmps</span>
<span class="co"># 1       -9   14</span>
<span class="co"># 2       -8   14</span>
<span class="co"># 3       -7   14</span>
<span class="co"># 4       -6   14</span>
<span class="co"># 5       -5   14</span>
<span class="co"># 6       -4   14</span>
<span class="co"># 7       -3   14</span>
<span class="co"># 8       -2   14</span>
<span class="co"># 9       -1   14</span>
<span class="co"># </span>
<span class="co"># $nseg</span>
<span class="co"># [1] 22</span></code></pre></div>
<p>And we have the plot of <code>x</code> and <code>y</code>.</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/step0.png" alt="A KM Comparison, x and y" width="80%"><p class="caption">
A KM Comparison, x and y
</p>
</div>
<div id="main-idea" class="section level4">
<h4 class="hasAnchor">
<a href="#main-idea" class="anchor"></a>Main Idea</h4>
<p>The main idea of the CMPS method is that:</p>
<ol>
<li>we take the first signature as the reference signature (<code>x</code>) and cut it into consecutive and non-overlapping basis segments of the same length. In this case, we set the length of a basis segment to be 50 units, and we have 22 basis segments in total.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="reference/figures/step1_1.png" alt="Cut x into consecutive and non-overlapping basis segments of the same length. Only 4 basis segments are shown here" width="80%"><p class="caption">
Cut x into consecutive and non-overlapping basis segments of the same length. Only 4 basis segments are shown here
</p>
</div>
<ol>
<li>for each basis segment, we compute the cross-correlation function (ccf) between the basis segment and the comparison signature (<code>y</code>)</li>
</ol>
<div class="figure" style="text-align: center">
<img src="reference/figures/step2_1.png" alt="y and 7th basis segment" width="80%"><p class="caption">
y and 7th basis segment
</p>
</div>
<div class="figure" style="text-align: center">
<img src="reference/figures/step2_2.png" alt="the cross-correlation function (ccf) between y and segment 7" width="80%"><p class="caption">
the cross-correlation function (ccf) between y and segment 7
</p>
</div>
<ul>
<li>for the <code>ccf</code> curve, the <code>position</code> represents the shift of the segment. A negative value means a shift to the left, a positive value means a shift to the right, and 0 means no shift (the segment stays at its original position in the reference signature);</li>
<li>we are interested in the peaks in the ccf curve and the positions of those peaks (as indicated by the red vertical line in the plot above). In other words, if we shift the segment, which position would give us the “best fit?”</li>
</ul>
<ol>
<li>If two signatures are similar (a KM comparison), most of the basis segments should agree with each other on the position of the best fit. Then these segments are called the “<strong>Congruent Matching Profile Segments</strong>.”</li>
</ol>
<div class="figure" style="text-align: center">
<img src="reference/figures/step1_2.png" alt="compare y to the basis segments of x" width="80%"><p class="caption">
compare y to the basis segments of x
</p>
</div>
<p>And ideally, if two signatures are identical, we are expecting the position of the highest peak in the ccf curve remains the same across all ccf curves (we only show 7 segments here);</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/step3_1.png" alt="ideal case: compare x to itself. The highest peak has value 1 and is marked by the blue dot" width="80%"><p class="caption">
ideal case: compare x to itself. The highest peak has value 1 and is marked by the blue dot
</p>
</div>
<p>But in the real case, the basis segments might not achieve a final agreement, but we have the majority;</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/step3_2.png" alt="real case: compare x to y. The 5 highest peaks are marked by the blue dots" width="80%"><p class="caption">
real case: compare x to y. The 5 highest peaks are marked by the blue dots
</p>
</div>
<p>We mark the 5 highest peaks for each ccf curve because the position of the “highest peak” might not be the best one.</p>
<ol>
<li>each ccf curve votes for 5 candidate positions, then we ask two questions in order to obtain the CMPS number/score:</li>
</ol>
<ul>
<li><p>which position receives the most votes? -&gt; the best position (indicated by the red vertical line)</p></li>
<li>
<p>how many segments have voted for the best position? -&gt; CMPS number</p>
<p>If we focus on these 7 segments only, and have a very short tolerance zone, the CMPS number is 6.</p>
<p>(If we consider all 22 segments, and have a default tolerance zone (+/- 25 units), the CMPS number is 20.)</p>
</li>
</ul>
<ol>
<li>false positive: how can the segments vote more wisely? -&gt; Multi Segment Lengths Strategy</li>
</ol>
<ul>
<li>by increasing the segment length (scale), one can reduce the number of “false positive” peaks</li>
</ul>
<div class="figure" style="text-align: center">
<img src="reference/figures/step5_1.png" alt="Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves" width="80%"><p class="caption">
Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves
</p>
</div>
<div class="figure" style="text-align: center">
<img src="reference/figures/step5_2.png" alt="Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves" width="80%"><p class="caption">
Multi Segment Lengths Strategy - increasing the segment length could decrease the number of false positive peaks in ccf curves
</p>
</div>
<ul>
<li>
<p>we choose 5 peaks at scale 1; 3 peaks at scale 2; 1 peak at scale 3</p>
<p>the peak shared by all three scales is a <strong>consistent correlation peak</strong> (ccp). And the position of the ccp is our best choice. Sometimes a ccp might not be found. Trying to identify a ccp for each basis segment is called a “multi segment lengths” strategy.</p>
</li>
<li>
<p>and then, each ccf curve votes for only 1 best condidate position if a ccp can be found; again, we ask two quesitons:</p>
<ul>
<li>which position receives the most votes?</li>
<li>how many segments have voted for this position? -&gt; CMPS number</li>
</ul>
</li>
<li><p>by default, CMPS algorithm uses the multi-segment lengths strategy.</p></li>
</ul>
<ol>
<li>if we consider all segments and use the multi-segment lengths strategy</li>
</ol>
<ul>
<li>when comparing x and y, a KM comparison, we have</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, seg_length <span class="op">=</span> <span class="fl">50</span>, seg_scale_max <span class="op">=</span> <span class="fl">3</span>, Tx <span class="op">=</span> <span class="fl">25</span>, 
                     npeaks.set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, full_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># $CMPS.score</span>
<span class="co"># [1] 14</span>
<span class="co"># </span>
<span class="co"># $rec.position</span>
<span class="co"># [1] -5</span>
<span class="co"># </span>
<span class="co"># $pos.df</span>
<span class="co">#   position cmps</span>
<span class="co"># 1       -9   14</span>
<span class="co"># 2       -8   14</span>
<span class="co"># 3       -7   14</span>
<span class="co"># 4       -6   14</span>
<span class="co"># 5       -5   14</span>
<span class="co"># 6       -4   14</span>
<span class="co"># 7       -3   14</span>
<span class="co"># 8       -2   14</span>
<span class="co"># 9       -1   14</span>
<span class="co"># </span>
<span class="co"># $nseg</span>
<span class="co"># [1] 22</span></code></pre></div>
<ul>
<li>if we have a KNM (known non-match) comparison, e.g. compare land 2-3 with land 1-3:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">land23</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"2-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">land13</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="st">"1-3"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">land23</span><span class="op">$</span><span class="va">sig</span>, <span class="va">land13</span><span class="op">$</span><span class="va">sig</span>, seg_length <span class="op">=</span> <span class="fl">50</span>, seg_scale_max <span class="op">=</span> <span class="fl">3</span>, Tx <span class="op">=</span> <span class="fl">25</span>, 
                     npeaks.set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, full_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">result</span><span class="op">$</span><span class="va">CMPS.score</span>
<span class="co"># [1] 1</span>

<span class="va">result</span><span class="op">$</span><span class="va">rec.position</span>
<span class="co"># [1] 128</span>

<span class="va">result</span><span class="op">$</span><span class="va">nseg</span>
<span class="co"># [1] 22</span></code></pre></div>
</div>
<div id="full-comparison-between-two-bullets" class="section level4">
<h4 class="hasAnchor">
<a href="#full-comparison-between-two-bullets" class="anchor"></a>Full Comparison Between Two Bullets</h4>
<p><code><a href="reference/extract_feature_cmps.html">extract_feature_cmps()</a></code> can also be used in a pipeline fashion</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bulletxtrctr</span><span class="op">)</span>

<span class="va">lands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span><span class="op">)</span>

<span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>land1 <span class="op">=</span> <span class="va">lands</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, land2 <span class="op">=</span> <span class="va">lands</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span>, 
                          stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>
  aligned <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">land1</span>, .y <span class="op">=</span> <span class="va">land2</span>, 
                        .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xx</span>, <span class="va">yy</span><span class="op">)</span> <span class="op">{</span>
                          <span class="va">land1</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="va">xx</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
                          <span class="va">land2</span> <span class="op">&lt;-</span> <span class="va">bullets</span><span class="op">$</span><span class="va">sigs</span><span class="op">[</span><span class="va">bullets</span><span class="op">$</span><span class="va">bulletland</span> <span class="op">==</span> <span class="va">yy</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
                          <span class="va">land1</span><span class="op">$</span><span class="va">bullet</span> <span class="op">&lt;-</span> <span class="st">"first-land"</span>
                          <span class="va">land2</span><span class="op">$</span><span class="va">bullet</span> <span class="op">&lt;-</span> <span class="st">"second-land"</span>
                          
                          <span class="fu">sig_align</span><span class="op">(</span><span class="va">land1</span><span class="op">$</span><span class="va">sig</span>, <span class="va">land2</span><span class="op">$</span><span class="va">sig</span><span class="op">)</span>
                        <span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>cmps <span class="op">=</span> <span class="va">aligned</span> <span class="op">%&gt;%</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="reference/extract_feature_cmps.html">extract_feature_cmps</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">lands</span><span class="op">$</span><span class="va">sig1</span>, <span class="va">a</span><span class="op">$</span><span class="va">lands</span><span class="op">$</span><span class="va">sig2</span>, full_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="co"># comparisons.cmps &lt;- comparisons.cmps %&gt;% </span>
<span class="co">#   mutate(cmps = aligned %&gt;% purrr::map_dbl(.f = function(a) {</span>
<span class="co">#     extract_feature_cmps(a$lands$sig1, a$lands$sig2, full_result = FALSE)</span>
<span class="co">#   }))</span>
<span class="co"># comparisons.cmps %&gt;% select(land1, land2, cmps) </span>

<span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    cmps_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">cmps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">CMPS.score</span><span class="op">)</span>,
    cmps_nseg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">cmps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">nseg</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">cp1</span> <span class="op">&lt;-</span> <span class="va">comparisons</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">land1</span>, <span class="va">land2</span>, <span class="va">cmps_score</span>, <span class="va">cmps_nseg</span><span class="op">)</span>
<span class="va">cp1</span>

<span class="co">#    land1 land2 cmps_score cmps_nseg</span>
<span class="co"># 1    1-1   2-1          2        23</span>
<span class="co"># 2    1-2   2-1          2        22</span>
<span class="co"># 3    1-3   2-1          1        21</span>
<span class="co"># 4    1-4   2-1          2        22</span>
<span class="co"># 5    1-5   2-1          1        23</span>
<span class="co"># 6    1-6   2-1         14        22</span>
<span class="co"># 7    1-1   2-2          5        23</span>
<span class="co"># 8    1-2   2-2          2        22</span>
<span class="co"># 9    1-3   2-2          1        21</span>
<span class="co"># 10   1-4   2-2          1        22</span>
<span class="co"># 11   1-5   2-2          2        23</span>
<span class="co"># 12   1-6   2-2          2        22</span>
<span class="co"># 13   1-1   2-3          3        23</span>
<span class="co"># 14   1-2   2-3         13        22</span>
<span class="co"># 15   1-3   2-3          2        21</span>
<span class="co"># 16   1-4   2-3          1        22</span>
<span class="co"># 17   1-5   2-3          1        23</span>
<span class="co"># 18   1-6   2-3          2        22</span>
<span class="co"># 19   1-1   2-4          4        23</span>
<span class="co"># 20   1-2   2-4          1        22</span>
<span class="co"># 21   1-3   2-4         11        21</span>
<span class="co"># 22   1-4   2-4          1        22</span>
<span class="co"># 23   1-5   2-4          2        23</span>
<span class="co"># 24   1-6   2-4          2        22</span>
<span class="co"># 25   1-1   2-5          3        23</span>
<span class="co"># 26   1-2   2-5          1        22</span>
<span class="co"># 27   1-3   2-5          2        21</span>
<span class="co"># 28   1-4   2-5         10        22</span>
<span class="co"># 29   1-5   2-5          2        23</span>
<span class="co"># 30   1-6   2-5          1        22</span>
<span class="co"># 31   1-1   2-6          2        23</span>
<span class="co"># 32   1-2   2-6          1        22</span>
<span class="co"># 33   1-3   2-6          2        21</span>
<span class="co"># 34   1-4   2-6          1        22</span>
<span class="co"># 35   1-5   2-6         15        23</span>
<span class="co"># 36   1-6   2-6          1        22</span></code></pre></div>
</div>
</div>
<div id="future-work" class="section level2">
<h2 class="hasAnchor">
<a href="#future-work" class="anchor"></a>Future Work</h2>
<ul>
<li><p>improve and manage to submit the cmpsR package to CRAN</p></li>
<li><p>cross-validate some hyper-parameters</p></li>
<li>
<p>apply CMPS to</p>
<ul>
<li>the dataset used in the paper to see if we can reproduce their results</li>
<li>other datasets</li>
</ul>
</li>
</ul>
</div>
<div id="reference" class="section level2">
<h2 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Chen:2019ji" class="csl-entry">
<p>Chen, Zhe, Wei Chu, Johannes A Soons, Robert M Thompson, John Song, and Xuezeng Zhao. 2019. “<span class="nocase">Fired Bullet Signature Correlation Using the Congruent Matching Profile Segments (CMPS) Method</span>.” <em>Forensic Science International</em>, December, #109964. <a href="https://doi.org/10.1016/j.forsciint.2019.109964" class="uri">https://doi.org/10.1016/j.forsciint.2019.109964</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Wangqian Ju <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9977-377X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/willju-wangqian/cmpsR/actions"><img src="https://github.com/willju-wangqian/cmpsR/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Wangqian Ju.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
