<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Computes the CMPS score of a comparison between two bullet profiles/signatures — extract_feature_cmps • CMPS</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Computes the CMPS score of a comparison between two bullet profiles/signatures — extract_feature_cmps" />
<meta property="og:description" content="Compute the Congruent Matching Profile Segments (CMPS) score based on two bullet profiles/signatures.
The reference profile will be divided into consecutive, non-overlapping, basis segments of the same length.
Then the number of segments that are congruent matching will be found as the CMPS score.
By default, extract_feature_cmps implements the algorithm with multi-peak insepction at three
different segment scales. By setting npeaks.set as a single-length vector, users can switch to the algorithm
with multi-peak inspection at the basis scale only." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CMPS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9.1000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Computes the CMPS score of a comparison between two bullet profiles/signatures</h1>
    
    <div class="hidden name"><code>extract_feature_cmps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute the Congruent Matching Profile Segments (CMPS) score based on two bullet profiles/signatures.
The reference profile will be divided into consecutive, non-overlapping, basis segments of the same length.
Then the number of segments that are congruent matching will be found as the CMPS score.
By default, <code>extract_feature_cmps</code> implements the algorithm with multi-peak insepction at three
different segment scales. By setting <code>npeaks.set</code> as a single-length vector, users can switch to the algorithm
with multi-peak inspection at the basis scale only.</p>
    </div>

    <pre class="usage"><span class='fu'>extract_feature_cmps</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>y</span>,
  seg_length <span class='op'>=</span> <span class='fl'>50</span>,
  Tx <span class='op'>=</span> <span class='fl'>25</span>,
  npeaks.set <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>3</span>, <span class='fl'>1</span><span class='op'>)</span>,
  include <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a numeric vector, vector of the reference bullet signature/profile that will be divided into basis segments</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>a numeric vector, vector of the comparison bullet signature/profile</p></td>
    </tr>
    <tr>
      <th>seg_length</th>
      <td><p>integer, the length of a basis segment</p></td>
    </tr>
    <tr>
      <th>Tx</th>
      <td><p>integer, the tolerance zone is <code>+/- Tx</code></p></td>
    </tr>
    <tr>
      <th>npeaks.set</th>
      <td><p>a numeric vector, specify the number of peaks to be found for each different scale of segment. The
number of peaks for the highest segment scale must be 1, i.e., the very last element of <code>npeaks.set</code> must be 1.</p><ul>
<li><p>If <code>length(npeaks.set) == 1</code>, the algorithm uses multi-peak inspection only at the basis scale;</p></li>
<li><p>If <code>length(npeaks.set) &gt; 1</code>, the algorithm uses multi-peak inspection at
different segment scales.</p></li>
<li><p>By default, <code>npeaks.set = c(5,3,1)</code>. Including more segment scales will reduce the number of false positive results</p></li>
</ul></td>
    </tr>
    <tr>
      <th>include</th>
      <td><p><code>NULL</code> or a vector of character strings indicating what additional information should be included in
the output of <code>extract_feature_cmps</code>. All possible options are: "nseg", "congruent.pos", "congruent.seg",
"congruent.seg.idx", "pos.df", "ccp.list","segments", and "parameters". If one wants to include them all, one can use
<code>include = "full_result</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a numeric value or a list</p><ul>
<li><p>if <code>include = NULL</code>, returns the CMPS score (a numeric value) only</p></li>
<li><p>if <code>include = </code> one or a vector of strings listed above:</p><ul>
<li><p><code>nseg</code>: number of basis segments</p></li>
<li><p><code>congruent.seg</code>: a vector of boolean values. <code>TRUE</code> means this basis segment is a congruent matching profile segment (CMPS)</p></li>
<li><p><code>congruent.seg.idx</code>: the indices of all CMPS</p></li>
<li><p><code>pos.df</code>: a dataframe that includes positions of correlation peaks and the CMPS score of these positions</p></li>
<li><p><code>ccp.list</code>: a list of consistent correlation peaks of each basis segment.</p></li>
<li><p><code>segments</code>: a list of all basis segments</p></li>
<li><p><code>parameters</code>: a list that stores all parameters used in the function call</p></li>
</ul></li>
</ul>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen, Zhe, Wei Chu, Johannes A Soons, Robert M Thompson, John Song,
and Xuezeng Zhao. 2019. “Fired Bullet Signature Correlation Using the
Congruent Matching Profile Segments (CMPS) Method.” Forensic Science
International, December, #109964. https://doi.org/10.1016/j.forsciint.2019.109964.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://heike.github.io/bulletxtrctr/'>bulletxtrctr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/heike/x3ptools'>x3ptools</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>CMPS</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"bullets"</span><span class='op'>)</span>
<span class='va'>land2_3</span> <span class='op'>&lt;-</span> <span class='va'>bullets</span><span class='op'>$</span><span class='va'>sigs</span><span class='op'>[</span><span class='va'>bullets</span><span class='op'>$</span><span class='va'>bulletland</span> <span class='op'>==</span> <span class='st'>"2-3"</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
<span class='va'>land1_2</span> <span class='op'>&lt;-</span> <span class='va'>bullets</span><span class='op'>$</span><span class='va'>sigs</span><span class='op'>[</span><span class='va'>bullets</span><span class='op'>$</span><span class='va'>bulletland</span> <span class='op'>==</span> <span class='st'>"1-2"</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># compute cmps</span>

<span class='co'># algorithm with multi-peak insepction at three different segment scales</span>
<span class='va'>cmps_with_multi_scale</span> <span class='op'>&lt;-</span> <span class='fu'>extract_feature_cmps</span><span class='op'>(</span><span class='va'>land2_3</span><span class='op'>$</span><span class='va'>sig</span>, <span class='va'>land1_2</span><span class='op'>$</span><span class='va'>sig</span>, include <span class='op'>=</span> <span class='st'>"full_result"</span> <span class='op'>)</span>

<span class='co'># algorithm with multi-peak inspection at the basis scale only</span>
<span class='va'>cmps_without_multi_scale</span> <span class='op'>&lt;-</span> <span class='fu'>extract_feature_cmps</span><span class='op'>(</span><span class='va'>land2_3</span><span class='op'>$</span><span class='va'>sig</span>, <span class='va'>land1_2</span><span class='op'>$</span><span class='va'>sig</span>, 
                                                 npeaks.set <span class='op'>=</span> <span class='fl'>5</span>, include <span class='op'>=</span> <span class='st'>"full_result"</span> <span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://heike.github.io/bulletxtrctr/'>bulletxtrctr</a></span><span class='op'>)</span>

<span class='va'>lands</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>bullets</span><span class='op'>$</span><span class='va'>bulletland</span><span class='op'>)</span>

<span class='va'>comparisons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>land1 <span class='op'>=</span> <span class='va'>lands</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>]</span>, land2 <span class='op'>=</span> <span class='va'>lands</span><span class='op'>[</span><span class='fl'>7</span><span class='op'>:</span><span class='fl'>12</span><span class='op'>]</span><span class='op'>)</span>, 
                          stringsAsFactors <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>comparisons</span> <span class='op'>&lt;-</span> <span class='va'>comparisons</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>
  aligned <span class='op'>=</span> <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map2.html'>map2</a></span><span class='op'>(</span>.x <span class='op'>=</span> <span class='va'>land1</span>, .y <span class='op'>=</span> <span class='va'>land2</span>, 
                        .f <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>xx</span>, <span class='va'>yy</span><span class='op'>)</span> <span class='op'>{</span>
                          <span class='va'>land1</span> <span class='op'>&lt;-</span> <span class='va'>bullets</span><span class='op'>$</span><span class='va'>sigs</span><span class='op'>[</span><span class='va'>bullets</span><span class='op'>$</span><span class='va'>bulletland</span> <span class='op'>==</span> <span class='va'>xx</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
                          <span class='va'>land2</span> <span class='op'>&lt;-</span> <span class='va'>bullets</span><span class='op'>$</span><span class='va'>sigs</span><span class='op'>[</span><span class='va'>bullets</span><span class='op'>$</span><span class='va'>bulletland</span> <span class='op'>==</span> <span class='va'>yy</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
                          <span class='va'>land1</span><span class='op'>$</span><span class='va'>bullet</span> <span class='op'>&lt;-</span> <span class='st'>"first-land"</span>
                          <span class='va'>land2</span><span class='op'>$</span><span class='va'>bullet</span> <span class='op'>&lt;-</span> <span class='st'>"second-land"</span>
                          
                          <span class='fu'><a href='https://heike.github.io/bulletxtrctr/reference/sig_align.html'>sig_align</a></span><span class='op'>(</span><span class='va'>land1</span><span class='op'>$</span><span class='va'>sig</span>, <span class='va'>land2</span><span class='op'>$</span><span class='va'>sig</span><span class='op'>)</span>
                        <span class='op'>}</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>comparisons</span> <span class='op'>&lt;-</span> <span class='va'>comparisons</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>cmps <span class='op'>=</span> <span class='va'>aligned</span> <span class='op'>%&gt;%</span> <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span>.f <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'>extract_feature_cmps</span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>lands</span><span class='op'>$</span><span class='va'>sig1</span>, <span class='va'>a</span><span class='op'>$</span><span class='va'>lands</span><span class='op'>$</span><span class='va'>sig2</span>, include <span class='op'>=</span> <span class='st'>"nseg"</span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># comparisons.cmps &lt;- comparisons %&gt;% </span>
<span class='co'>#   mutate(cmps = aligned %&gt;% purrr::map_dbl(.f = function(a) {</span>
<span class='co'>#     extract_feature_cmps(a$lands$sig1, a$lands$sig2, include = NULL)</span>
<span class='co'>#   }))</span>
<span class='co'># comparisons.cmps %&gt;% select(land1, land2, cmps) </span>

<span class='va'>comparisons</span> <span class='op'>&lt;-</span> <span class='va'>comparisons</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    cmps_score <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>comparisons</span><span class='op'>$</span><span class='va'>cmps</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>$</span><span class='va'>CMPS.score</span><span class='op'>)</span>,
    cmps_nseg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>comparisons</span><span class='op'>$</span><span class='va'>cmps</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>$</span><span class='va'>nseg</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>cp1</span> <span class='op'>&lt;-</span> <span class='va'>comparisons</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='va'>land1</span>, <span class='va'>land2</span>, <span class='va'>cmps_score</span>, <span class='va'>cmps_nseg</span><span class='op'>)</span>
<span class='va'>cp1</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wangqian Ju.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


